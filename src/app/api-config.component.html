<div>
  <div style="height: 75vh; overflow: auto;">
    <table mat-table [dataSource]="apiConfig | keyvalue">
      <tbody>
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 80px;"> Id </th>
          <td mat-cell *matCellDef="let row">
            <div style="display: flex; width: 70%;" 
              #tooltip="matTooltip"
              [matTooltip]="fetchSubcontextTooltip(row.key)"
              matTooltipClass="subcontext-tooltip"
              matTooltipPosition="above" >
              <div style="margin-top: 8px;" *ngIf="!serverConfigViewActivated">
                <mat-checkbox [(ngModel)]="row.value.edit"></mat-checkbox>
              </div>
              <mat-form-field appearance="outline">
                <mat-select 
                  [(ngModel)]="row.key" 
                  [disabled]="!row.value.edit"
                  >
                  <mat-option *ngFor="let id of allIds" [value]="id">
                    {{ id }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="resolver_module">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 20px;"> Resolver </th>
          <td mat-cell *matCellDef="let row" style="padding-left: 20px;">
            <div>
              <mat-form-field appearance="outline" style="margin: 10px 0px;  width: 100%;" 
                [matTooltip]="row.value.resolver_module"
                matTooltipClass="subcontext-tooltip"
                matTooltipPosition="after"  
                >
                <mat-select [(ngModel)]="row.value.resolver_module" [disabled]="!row.value.edit">
                  <mat-option *ngFor="let resolver of availableResolvers" [value]="resolver">
                    <span 
                      [matTooltip]="resolver"
                      matTooltipClass="subcontext-tooltip"
                      matTooltipPosition="right"
                    >{{ resolver }}</span>
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </td>
        </ng-container>
      
        <ng-container matColumnDef="old_url">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 30px;width: 55%;"> Old URL </th>
          <td mat-cell *matCellDef="let row" style="text-align: center;width: 55%;">
            <mat-form-field style="margin: 10px 0px;  width: 100%;" 
                appearance="outline"
                [matTooltip]="row.value.old_url"
                matTooltipClass="subcontext-tooltip"
                matTooltipPosition="above" 
            >
              <input  style="font-weight: 500;" matInput placeholder="Old URL" [(ngModel)]="row.value.old_url" [disabled]="!row.value.edit">
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="new_url">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 30px; width: 55%;"> New URL </th>
          <td mat-cell *matCellDef="let row" style="text-align: center;width: 55%;">
            <mat-form-field style="margin: 10px 0px;  width: 100%;" appearance="outline"
                [matTooltip]="row.value.new_url"
                matTooltipClass="subcontext-tooltip"
                matTooltipPosition="above">
              <input style="font-weight: 500;" matInput placeholder="New URL" [(ngModel)]="row.value.new_url" [disabled]="!row.value.edit">
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 30px;"> Active </th>
          <td mat-cell *matCellDef="let row" style="text-align: center;">
            <div style="margin-bottom: 18px;">
              <mat-checkbox [(ngModel)]="row.value.active" [disabled]="serverConfigViewActivated"></mat-checkbox>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="config">
          <th mat-header-cell *matHeaderCellDef style="text-align: center; width: 35%;">Config</th>
          <td mat-cell *matCellDef="let row" style="text-align: center; width: 35%;">
            <div style="margin-bottom: 18px;">
              <button mat-icon-button color="primary" (click)="toggleExpand(row.key)"
                matTooltip="Configure"
                matTooltipPosition="above">
                <mat-icon>settings</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
  
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let row">
            <div style="margin-bottom: 18px;"  *ngIf="!serverConfigViewActivated">
              <button mat-icon-button color="warn" (click)="deleteApiConfig(row.key)"
                matTooltip="Delete"
                matTooltipPosition="above">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
      
        <tr mat-header-row *matHeaderRowDef="['id', 'resolver_module', 'old_url', 'new_url', 'active', 'config', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['id', 'resolver_module', 'old_url', 'new_url', 'active', 'config', 'actions'];"></tr>
      </tbody>
    </table>
  </div>
  <div style="display: flex; justify-content: flex-end; margin: 30px;" *ngIf="!serverConfigViewActivated">
    <button mat-raised-button color="accent" (click)="addApiConfig()" [disabled]="!hasNewEntry">Add</button>
    <button mat-raised-button style="margin-left: 10px;" color="primary" (click)="save()">Save</button>
  </div>
</div>